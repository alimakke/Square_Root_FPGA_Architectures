#include <stdio.h>

unsigned int *timer_status = 0x80008800;
unsigned int *timer_control = 0x80008804;
unsigned int *timer_periodl = 0x80008808;
unsigned int *timer_periodh =0x8000880C ;
unsigned int *timer_snapl = 0x80008810;
unsigned int *timer_snaph = 0x80008814;


//****************************************************************************
//  FONCTION DE MESURE DE TEMPS
unsigned int timer_period;

void start_timer()
{
	*timer_control = 0x00000006;
}

unsigned int get_timer_period ()
{
	return ((((*timer_periodh)<<16))+(*timer_periodl));
}

unsigned int get_timer_value ()
{
	*timer_snapl = 0;
	return (((*timer_snaph)<<16)+(*timer_snapl));
}

unsigned int compute_time_interval(unsigned int v1, unsigned int v2)
{
	unsigned int time_interval;
	if (v1>=v2)
	{
		time_interval = v1-v2;
	}
	else
	{
		time_interval = v1 + timer_period - v2;
	}
	return time_interval;
}
//---------------------------------------------------------------------------------

/************************************************/
/*       Calcul racine carrée					*/
unsigned int  sqrt1(unsigned int Xio){
	if(Xio ==0) return 0;
	unsigned int x=Xio;
	unsigned int x_prev;
	do{
		x_prev=x;
		x=(x+Xio/x)>>1;
	}while(x<x_prev);
	return x;
	
}

unsigned int  sqrt2(unsigned int Xio){
	 unsigned long long  X =1U<<62;
	 unsigned long long  V=1U<<30;
	 unsigned long long  Z=1U<<31;
	 int i;
	 for ( i=30; i>=0; i--) {
	      if (X>Xio) {
	      X= X+ V*(V-(Z<<1));
	      Z= Z-V;
	      	  	    }
	      else if (X<Xio) {
	      X = X+V*(V+(Z<<1));
	      Z = Z+V;
	        			}
	    V=(V>>1);
	    						   }

	    if (X>Xio){
	        return (unsigned int) Z-1;
	    } else {
	        return (unsigned int)  Z;
	    }
}

unsigned int  sqrt3(unsigned int Xio){
	 unsigned long long V =1ULL<<62;
	 unsigned long long Z=0UL;
	 int i;
	 	 for (i=31; i>=0; i--) {
	 		Z= Z+V;
	 		if (Xio>=Z) {
	 			Xio=Xio-Z;
	 			Z=Z+V;
	 		}
	 		else{
	 			Z=Z-V;
	 		}
	 		Z=Z>>1;
	 		V=V>>2;
	 	 }
	 	 return (unsigned int)Z;
}


int main()
{ 
	unsigned int first_value, second_value, res, computation_time;
	unsigned short k;
  
	timer_period = get_timer_period();

  	printf("Initialisation terminée\n");

	start_timer();
	
	computation_time = 0;

	for (k=0; k<1000; k++)
	{
		first_value = get_timer_value();
		res=sqrt1(2550409);
		second_value = get_timer_value();
		computation_time = computation_time + compute_time_interval(first_value,second_value);
	}
	

	printf("res: %u, durée sqrt1: %u\n",res,computation_time/1000);
	
	computation_time = 0;

	for (k=0; k<1000; k++)
	{
		first_value = get_timer_value();
		res=sqrt2(2550409);
		second_value = get_timer_value();
		computation_time = computation_time + compute_time_interval(first_value,second_value);
	}
	

	printf("res: %u, durée sqrt2: %u\n",res,computation_time/1000);
	
	computation_time = 0;

	for (k=0; k<1000; k++)
	{
		first_value = get_timer_value();
		res=sqrt3(2550409);
		second_value = get_timer_value();
		computation_time = computation_time + compute_time_interval(first_value,second_value);
	}
	

	printf("res: %u, durée sqrt3: %u\n",res,computation_time/1000);
	
  return 0;
}
